
# aws-step-functions

This directory contains AWS step function definitions used by the smart-security-camera project.  At the time of writing it is **not possible to edit a step function once it is created**.  Therefore you should **always** keep a copy of this file if you make any changes.

## Contents

* **step-function-image-processing.json** - Process definition for step function.
* **step-function-image-processing.jpg** - visual representation of step function generated by AWS.

## How to use

### Prerequisites

1. You'll need to have created an AWS user and be logged into the [Step Function Console](https://aws.amazon.com/step-functions/).
2. You'll need to have created the [AWS Lambda functions](https://github.com/markwest1972/smart-security-camera/tree/master/aws-lambda-functions) in order to add them to your state machine.  You'll need the arn values for each function.

### Setting up the Step Function (aka State Machine)

To define a step function you'll need to visit the [Step Function Console](https://aws.amazon.com/step-functions/) and create a **State Machine**. Some tips for doing this:

1. Paste the contents of **step-function-image-processing.json** into the AWS Create State Machine wizard.
2. 
3. Call the resulting state machine **step-function-image-processing** to ensure that it works with the other [smart-security-camera](https://github.com/markwest1972/smart-security-camera) components.
4. You'll need to define an IAM role for the state machine.  This role will require the **AWSLambdaRole** permission so that the Step Function is allowed to call the Lambda Functions that it will orchestrate.  One way to create and change IAM roles is from the IAM Console (available from the Services menu when logged into the [AWS Console](https://aws.amazon.com/console/)).
